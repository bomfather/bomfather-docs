---
import BaseLayout from '../layouts/BaseLayout.astro';
import PageSection from '../components/ui/PageSection.astro';
import { getCollection } from 'astro:content';

// Get all news articles and sort by date (newest first)
const newsArticles = await getCollection('news', ({ data }) => {
  return !data.draft;
});

newsArticles.sort((a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime());

// Render content for each article
const articlesWithContent = await Promise.all(
  newsArticles.map(async (article) => {
    const { Content } = await article.render();
    return { ...article, Content };
  })
);

// Format date for display
const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    timeZone: 'UTC'
  });
};

 

---

<BaseLayout 
  title="News - Bomfather"
  description="Latest news and updates from Bomfather - kernel-level AI security powered by eBPF"
  showAnnouncement={false}
  showNewsletter={false}
>
  <!-- News Header -->
  <PageSection 
    id="news-header"
    variant="dark"
    size="lg"
    title="News & Updates"
    headerLevel={1}
    centerHeader={true}
    className="news-header-section"
  >
  </PageSection>

  <!-- News Articles -->
  <PageSection 
    id="news-articles"
    variant="dark"
    size="lg"
    className="news-articles-section"
  >
    <div class="news-container">
      {articlesWithContent.map((article, index) => (
        <article class="featured-article" style={`--delay: ${index * 0.1}s`}> 
          <div class="article-header">
            <span class="article-category">{article.data.category}</span>
            <time class="article-date" datetime={article.data.publishedAt.toISOString()}>
              {formatDate(article.data.publishedAt)}
            </time>
          </div>
          <h2 class="article-title">{article.data.title}</h2>
          {article.data.description && (
            <p class="article-excerpt">
              {article.data.description}
            </p>
          )}

          {article.data.externalLink && (
            <p class="external-link-cta">
              <a href={article.data.externalLink} target="_blank" rel="noopener noreferrer" class="inline-text-link">
                Read the paper on arXiv
                <svg class="inline-text-link-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            </p>
          )}
          <div class="article-content">
            <article.Content />
          </div>
          
        </article>
      ))}
      
      {articlesWithContent.length === 0 && (
        <div class="no-news-message">
          <h3>No news articles yet</h3>
          <p>Check back soon for the latest updates on Bomfather's journey to revolutionize AI security.</p>
        </div>
      )}
    </div>
  </PageSection>
</BaseLayout>

<style is:global>
/* Professional Theme Base - matching homepage */
:root {
  --bg-primary: #f9f8f4;
  --bg-secondary: #f9f8f4;
  --bg-tertiary: #FFFFFF;
  --text-primary: var(--color-text-primary);
  --text-secondary: var(--color-text-secondary);
  --text-tertiary: var(--color-text-tertiary);
  --accent-primary: var(--color-primary);
  --accent-secondary: #3b82f6;
  --accent-gradient: linear-gradient(135deg, var(--color-primary) 0%, #1d4ed8 100%);
  --border-color: var(--color-border-light);
  --glass-bg: #FFFFFF;
  --shadow-professional: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
  
  /* Professional spacing */
  --spacing-xs: 0.5rem;
  --spacing-sm: 0.75rem;
  --spacing-md: 1rem;
  --spacing-lg: 1.5rem;
  --spacing-xl: 2rem;
  --spacing-2xl: 3rem;
}

/* Professional Global Styles */
* {
  box-sizing: border-box;
}

body {
  background: var(--bg-primary) !important;
  color: var(--text-secondary);
  font-family: 'Fira Code', 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
  line-height: 1.6;
  font-size: 14px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Keep Inter for hero titles and main headings */
.hero-title,
.hero-subtitle,
.page-section h1,
.page-section h2,
.page-section h3,
.article-title,
.more-news-placeholder h3 {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
}

  .news-header-section {
    padding-top: 8rem !important;
    padding-bottom: 2.5rem !important;
  }

  .news-articles-section {
    padding-top: 1rem !important;
  }

  .news-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  /* Clean list layout: flat background with clear separators */
  .featured-article {
    background: transparent;
    border: none;
    border-radius: 0;
    padding: 2.5rem 0;
    margin: 0;
    box-shadow: none;
    border-bottom: 2px solid var(--border-color);
  }

  .featured-article:first-child {
    border-top: 2px solid var(--border-color);
  }

  /* Remove divider on the last article to avoid a trailing line */
  .featured-article:last-child {
    border-bottom: 0;
  }

  /* Removed zebra tint for a cleaner, high-contrast separation */

  

  .article-header {
    display: grid;
    grid-template-columns: auto 1fr auto;
    column-gap: 0.75rem;
    align-items: center;
    margin-bottom: 1.25rem;
  }

  .article-category {
    color: var(--accent-primary);
    background: transparent;
    padding: 0;
    border-radius: 0;
    font-size: 0.875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    grid-column: 1 / 2;
  }

  .article-date {
    color: var(--text-secondary);
    font-size: 1rem;
    font-weight: 500;
    justify-self: end;
  }

  .article-title {
    font-size: 1.75rem;
    font-weight: 800;
    color: var(--text-primary);
    line-height: 1.2;
    margin-bottom: 0.75rem;
    letter-spacing: -0.02em;
  }

  .article-excerpt {
    font-size: 1rem;
    color: var(--text-secondary);
    line-height: 1.65;
    margin-bottom: 1.25rem;
    font-weight: 500;
    font-style: italic;
  }

  .article-content {
    font-family: 'Fira Code', 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', monospace;
    line-height: 1.8;
    color: var(--text-secondary);
    margin-bottom: 2rem;
  }

  /* Inline external link under excerpt (no bubble) */
  .featured-article .external-link-cta {
    margin-top: 0.5rem;
    margin-bottom: 1.75rem;
    font-size: 1rem;
    line-height: 1.65;
  }

  .featured-article .inline-text-link {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    color: var(--accent-primary);
    text-decoration: underline;
    text-underline-offset: 3px;
    text-decoration-thickness: 1px;
    font-weight: 600;
    white-space: nowrap;
  }

  .featured-article .inline-text-link:hover { color: var(--accent-secondary); }

  .featured-article .inline-text-link-icon { opacity: 0.85; }

  /* Floated images for wrapped text in news articles */
  .article-content img.news-float-image {
    float: right;
    width: 320px;
    max-width: 40%;
    height: auto;
    margin: 0 0 1.5rem 1.5rem;
    border-radius: 8px;
  }

  /* Target all paragraphs in the article content more specifically */
  .article-content > p,
  .article-content p {
    margin-bottom: 2.5rem !important;
    font-size: 1rem;
    line-height: 1.8;
  }

  .article-content > p:last-child,
  .article-content p:last-child {
    margin-bottom: 0 !important;
  }

  /* Ensure proper spacing for all text elements */
  .article-content > * + * {
    margin-top: 2rem;
  }

  .article-content > p + p {
    margin-top: 2.5rem;
  }

  .article-content strong {
    color: var(--text-primary);
    font-weight: 600;
  }

  .article-content h2,
  .article-content h3 {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
    color: var(--text-primary);
    margin-top: 2.5rem;
    margin-bottom: 1.5rem;
    font-weight: 600;
  }

  .article-content h2 {
    font-size: 1.5rem;
  }

  .article-content h3 {
    font-size: 1.25rem;
  }

  .article-content ul,
  .article-content ol {
    margin: 2rem 0;
    padding-left: 2rem;
    font-size: 1rem;
  }

  /* Tailwind preflight removes bullets; re-enable them for article content */
  .article-content ul {
    list-style: disc;
  }

  .article-content ol {
    list-style: decimal;
  }

  .article-content li {
    margin-bottom: 0.75rem;
    line-height: 1.7;
    font-size: 1rem;
  }

  .article-content blockquote {
    background: var(--bg-secondary);
    border-left: 4px solid var(--accent-primary);
    padding: 1.5rem;
    margin: 3rem 0 !important;
    border-radius: 0 0.5rem 0.5rem 0;
    font-style: italic;
    position: relative;
  }

  .article-content blockquote::before {
    content: none;
  }

  .article-content blockquote p {
    margin-bottom: 1rem !important;
    margin-top: 0 !important;
  }

  .article-content blockquote p:last-child {
    margin-bottom: 0 !important;
  }

  .section-subtitle {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 2rem 0 1rem 0;
  }

  .research-list {
    margin: 1.5rem 0;
    padding-left: 0;
    list-style: none;
  }

  .research-list li {
    position: relative;
    padding-left: 2rem;
    margin-bottom: 0.75rem;
    color: var(--text-secondary);
    line-height: 1.6;
  }

  .research-list li::before {
    content: 'â€¢';
    position: absolute;
    left: 0;
    color: var(--accent-primary);
    font-weight: bold;
    font-size: 1.2rem;
  }

  

  

  

  


  /* Responsive Design */
  @media (max-width: 768px) {
    .news-container {
      padding: 0 0.5rem;
    }

    .featured-article {
      padding: 2rem 0;
    }

    .article-title {
      font-size: 1.5rem;
    }

    .article-excerpt {
      font-size: 1rem;
    }

    .article-content {
      font-size: 0.95rem;
    }

    .article-content > p,
    .article-content p {
      margin-bottom: 2rem !important;
    }

    .article-content > p + p {
      margin-top: 2rem;
    }

    .article-content h2,
    .article-content h3 {
      margin-top: 2rem;
      margin-bottom: 1rem;
    }

    /* Disable float on small screens */
    .article-content img.news-float-image {
      float: none;
      display: block;
      width: 100%;
      max-width: 100%;
      margin: 0 0 1rem 0;
    }

    .article-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }
  }

  /* Subtle fade-in for articles */
  .featured-article {
    opacity: 0;
    transform: translateY(12px);
    animation: slideInUp 0.5s ease-out forwards;
  }

  .no-news-message {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-secondary);
  }

  .no-news-message h3 {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 1rem;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
  }

  @keyframes slideInUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
