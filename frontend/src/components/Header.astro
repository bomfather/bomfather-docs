---
// Header component for site navigation
---

<header class="header-nav bg-transparent z-50">
  <div class="container mx-auto px-6">
    <div class="header-content">
      <!-- Logo -->
      <div class="header-logo">
        <a href="/" class="flex items-center">
          <img src="/images/logos/bomfather-long-logo.png" alt="Bomfather Logo" class="h-10" />
        </a>
      </div>

      <!-- Desktop Navigation - Centered -->
      <nav class="header-nav-center hidden lg:flex items-center">
        <!-- Navigation pill container -->
        <div class="nav-pill">
          <!-- Products dropdown -->
          <div class="relative group" id="products-dropdown">
            <button id="products-button" class="nav-link dropdown-trigger">
              Products
              <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 12 12" fill="none">
                <path d="M2 4L6 8L10 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            
            <div id="products-menu" class="dropdown-menu">
              <div class="dropdown-content">
                <div class="dropdown-section">
                  <div class="dropdown-item">
                    <a href="/protect-ai" class="dropdown-link">
                      <div class="dropdown-icon protect-ai-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                          <path d="M12 2L3 7V12C3 16.55 6.84 20.74 9.91 21.86C11.44 22.32 12.56 22.32 14.09 21.86C17.16 20.74 21 16.55 21 12V7L12 2Z" stroke="currentColor" stroke-width="2" fill="none"/>
                          <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </div>
                      <div>
                        <div class="dropdown-title">Protect AI</div>
                        <div class="dropdown-description">Kernel-level AI security</div>
                      </div>
                    </a>
                  </div>
                  <div class="dropdown-item">
                    <a href="/protect-builds" class="dropdown-link">
                      <div class="dropdown-icon protect-builds-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                          <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                      </div>
                      <div>
                        <div class="dropdown-title">Protect Builds</div>
                        <div class="dropdown-description">Zero-trust build security</div>
                      </div>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Navigation links -->
          <a href="/blog" class="nav-link">Blog</a>
          <a href="/news" class="nav-link">News</a>
          <a href="/about" class="nav-link">About</a>
        </div>
      </nav>

      <!-- CTA Button -->
      <div class="header-cta hidden lg:flex items-center space-x-4">
        <a href="mailto:contact@bomfather.dev" class="cta-button">
          Contact Us
        </a>
      </div>

      <!-- Mobile menu button -->
      <div class="lg:hidden">
        <button id="mobile-menu-button" class="mobile-menu-button">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M3 12h18M3 6h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="mobile-menu">
    <div class="mobile-menu-content">
      <button id="mobile-menu-close" class="mobile-menu-close">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      
      <nav class="mobile-nav">
        <a href="/about" class="mobile-nav-link">About</a>
        <a href="/blog" class="mobile-nav-link">Blog</a>
        <a href="/news" class="mobile-nav-link">News</a>
        <a href="/protect-ai" class="mobile-nav-link">Protect AI</a>
        <a href="/protect-builds" class="mobile-nav-link">Protect Builds</a>
        <a href="mailto:contact@bomfather.dev" class="mobile-nav-link mobile-nav-cta">Contact Us</a>
      </nav>
    </div>
  </div>
</header>

<style>
  .header-nav {
    position: sticky;
    top: 0;
    background: transparent;
    z-index: 50;
    transition: transform 0.2s ease;
    will-change: transform;
    backface-visibility: hidden;
    transform: translateZ(0);
  }

  .header-content {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    padding: 1rem 0;
  }

  .header-logo {
    justify-self: start;
  }

  .header-nav-center {
    justify-self: center;
  }

  .header-cta {
    justify-self: end;
  }

  .nav-pill {
    display: flex;
    align-items: center;
    background: var(--color-surface);
    border: 1px solid var(--color-border-light);
    border-radius: 50px;
    padding: 4px;
    backdrop-filter: blur(20px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .nav-link {
    color: var(--color-text-tertiary); /* muted by default for contrast on hover */
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 12px 20px;
    border-radius: 46px;
    position: relative;
    white-space: nowrap;
    text-decoration: none;
  }

  .nav-link:hover { background: rgba(15, 23, 42, 0.06); color: var(--color-text-primary); }

  .dropdown-trigger {
    cursor: pointer;
  }

  .dropdown-arrow {
    transition: transform 0.2s ease;
  }

  .dropdown-menu {
    position: absolute;
    top: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%);
    min-width: 320px;
    background: var(--color-surface);
    border: 1px solid var(--color-border-light);
    border-radius: 12px;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.05);
    opacity: 0;
    visibility: hidden;
    transform: translateX(-50%) translateY(-8px);
    transition: all 0.2s ease;
    backdrop-filter: blur(20px);
    z-index: 1001 !important;
  }

  /* Desktop hover behavior */
  @media (min-width: 1024px) {
    .group:hover .dropdown-menu {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(0);
    }

    .dropdown-trigger:hover .dropdown-arrow,
    .group:hover .dropdown-arrow {
      transform: rotate(180deg);
    }
  }

  /* Mobile - disable all hover states */
  @media (max-width: 1023px) {
    .group:hover .dropdown-menu {
      opacity: 0 !important;
      visibility: hidden !important;
    }
    
    .dropdown-menu.mobile-show {
      opacity: 1 !important;
      visibility: visible !important;
      transform: translateX(-50%) translateY(0) !important;
      position: fixed !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      z-index: 1001 !important;
    }
  }

  /* Dropdown backdrop */
  .dropdown-backdrop {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    background: rgba(10, 13, 20, 0.95) !important;
    backdrop-filter: blur(4px);
    z-index: 1000 !important;
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
    pointer-events: auto;
  }

  .dropdown-backdrop.show {
    opacity: 1 !important;
    visibility: visible !important;
  }

  .dropdown-content {
    padding: 8px;
  }

  .dropdown-section + .dropdown-section {
    border-top: 1px solid var(--color-border-light);
    margin-top: 8px;
    padding-top: 8px;
  }

  .dropdown-item {
    margin-bottom: 4px;
  }

  .dropdown-item:last-child {
    margin-bottom: 0;
  }

  .dropdown-link {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 12px;
    border-radius: 8px;
    text-decoration: none;
    transition: background-color 0.15s ease;
  }

  .dropdown-link:hover { background: rgba(15, 23, 42, 0.05); }

  .dropdown-icon {
    flex-shrink: 0;
    color: var(--color-text-muted);
    margin-top: 2px;
  }

  .dropdown-title {
    color: var(--color-text-primary);
    font-weight: 500;
    font-size: 14px;
    line-height: 1.4;
    margin-bottom: 2px;
  }

  .dropdown-description {
    color: var(--color-text-secondary);
    font-size: 13px;
    line-height: 1.4;
  }

  /* Header CTA follows CSS variables so brand updates propagate */
  .cta-button {
    background-color: var(--color-primary);
    color: #ffffff;
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    transition: background-color 0.2s ease, opacity 0.2s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
  }
  .cta-button:hover { filter: brightness(0.95); }

  .mobile-menu-button {
    color: var(--color-text-primary);
    padding: 0.5rem;
    border-radius: 0.5rem;
    transition: background-color 0.2s ease;
  }
  
  .mobile-menu-button:hover {
    background-color: var(--color-surface-secondary);
  }

  .mobile-menu {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(13, 27, 42, 0.95);
    backdrop-filter: blur(20px);
    z-index: 100;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .mobile-menu.show {
    opacity: 1;
    visibility: visible;
  }

  .mobile-menu-content {
    height: 100%;
    padding: 24px;
    display: flex;
    flex-direction: column;
  }

  .mobile-menu-close {
    @apply text-white p-2 rounded-lg hover:bg-white/5 transition-colors;
    align-self: flex-end;
    margin-bottom: 32px;
  }

  .mobile-nav {
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex: 1;
    justify-content: center;
    align-items: center;
    max-width: 300px;
    margin: 0 auto;
  }

  .mobile-nav-link {
    @apply text-white text-xl font-medium py-4 px-6 rounded-lg hover:bg-white/5 transition-colors text-center w-full;
    text-decoration: none;
  }

  .mobile-nav-cta {
    background-color: var(--color-primary);
    margin-top: 2rem;
  }
  .mobile-nav-cta:hover { filter: brightness(0.95); }

  /* Animation for dropdown arrows */
  @keyframes dropdown-enter {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(-8px);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }

  @keyframes dropdown-leave {
    from {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    to {
      opacity: 0;
      transform: translateX(-50%) translateY(-8px);
    }
  }

  /* Hide-on-scroll state (CSS fallback if JS style not applied) */
  .header-nav.header-hidden { transform: translateY(-150%); }
</style>

<script>
  function initHeaderInteractions() {
    // Mobile menu functionality
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuClose = document.getElementById('mobile-menu-close');
    
    mobileMenuButton?.addEventListener('click', () => {
      mobileMenu?.classList.add('show');
      document.body.style.overflow = 'hidden';
    });
    
    mobileMenuClose?.addEventListener('click', () => {
      mobileMenu?.classList.remove('show');
      document.body.style.overflow = 'auto';
    });

    // Close mobile menu when clicking on backdrop
    mobileMenu?.addEventListener('click', (e) => {
      if (e.target === mobileMenu) {
        mobileMenu.classList.remove('show');
        document.body.style.overflow = 'auto';
      }
    });

    // Dropdown functionality for mobile devices
    const dropdownTriggers = document.querySelectorAll('.dropdown-trigger');
    let dropdownBackdrop = null;
    let activeDropdown = null;
    
    // Create backdrop element
    function createBackdrop() {
      if (!dropdownBackdrop) {
        dropdownBackdrop = document.createElement('div');
        dropdownBackdrop.className = 'dropdown-backdrop';
        document.body.appendChild(dropdownBackdrop);
        
        // Close dropdown when clicking backdrop
        dropdownBackdrop.addEventListener('click', closeAllDropdowns);
      }
    }
    
    // Show backdrop
    function showBackdrop() {
      createBackdrop();
      setTimeout(() => {
        dropdownBackdrop.classList.add('show');
      }, 10);
    }
    
    // Hide backdrop
    function hideBackdrop() {
      if (dropdownBackdrop) {
        dropdownBackdrop.classList.remove('show');
      }
    }
    
    // Close all dropdowns
    function closeAllDropdowns() {
      document.querySelectorAll('.dropdown-menu').forEach(menu => {
        menu.classList.remove('mobile-show');
      });
      activeDropdown = null;
      hideBackdrop();
    }
    
    dropdownTriggers.forEach(trigger => {
      trigger.addEventListener('click', (e) => {
        if (window.innerWidth < 1024) { // Only on mobile/tablet
          e.preventDefault();
          e.stopPropagation();
          
          const menu = trigger.parentElement?.querySelector('.dropdown-menu');
          
          if (!menu) return;
          
          // If this dropdown is already open, close it
          if (activeDropdown === menu) {
            closeAllDropdowns();
            return;
          }
          
          // Close any other open dropdowns
          closeAllDropdowns();
          
          // Show backdrop first
          showBackdrop();
          
          // Then show dropdown
          setTimeout(() => {
            menu.classList.add('mobile-show');
            activeDropdown = menu;
          }, 50);
        }
      });
    });

    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
      if (window.innerWidth < 1024) {
        if (!e.target?.closest('.group') && !e.target?.closest('.dropdown-backdrop')) {
          closeAllDropdowns();
        }
      }
    });

    // Handle window resize
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 1024) {
        closeAllDropdowns();
      }
    });

    // Hide header on scroll down, show on scroll up
    let lastScrollY = window.scrollY;
    let ticking = false;

    function getNewsBannerHeight() { return 0; }

    let headerEl = document.querySelector('.header-nav');
    let headerHeight = headerEl?.offsetHeight || 0;

    // Keep headerHeight fresh
    if (headerEl && 'ResizeObserver' in window) {
      const ro = new ResizeObserver(() => { headerHeight = headerEl.offsetHeight || 0; });
      ro.observe(headerEl);
    }

    function updateHeaderOnScroll() {
      const currentY = window.scrollY;
      const header = document.querySelector('.header-nav');
      const mobileMenuOpen = mobileMenu?.classList.contains('show');
      if (!header || mobileMenuOpen) {
        lastScrollY = currentY;
        ticking = false;
        return;
      }

      const delta = currentY - lastScrollY;
      const threshold = 24;
      const scrolledDown = delta > 2 && currentY > threshold;
      const scrolledUp = delta < -2;

      // Use inline transform for highest precedence
      const hideY = -headerHeight;
      if (scrolledDown) {
        header.style.transform = `translateY(${hideY}px)`;
        header.classList.add('header-hidden');
      } else if (scrolledUp) {
        header.style.transform = 'translateY(0)';
        header.classList.remove('header-hidden');
      }

      lastScrollY = currentY;
      ticking = false;
    }

    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(updateHeaderOnScroll);
        ticking = true;
      }
    }, { passive: true });

    // Initialize state on load
    window.requestAnimationFrame(updateHeaderOnScroll);
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initHeaderInteractions);
  } else {
    initHeaderInteractions();
  }
</script> 